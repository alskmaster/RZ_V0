<div class="report-module-instance" {% if new_page %}style="page-break-before: always;"{% endif %}>
  <h2>{{ title or 'Resumo de Disponibilidade (Uptime)' }}</h2>

  {% if data.error %}
    <div class="alert alert-warning" role="alert">{{ data.error }}</div>
  {% elif not data.hosts_data %}
    <div class="alert alert-info" role="alert">
      Nenhum dado de disponibilidade encontrado para os filtros selecionados.
    </div>
  {% else %}
    <p class="text-muted small">
      Periodo de analise: de <strong>{{ data.period_start_str }}</strong> ate <strong>{{ data.period_end_str }}</strong>.
    </p>

    <div class="row g-4">
      {% for host in data.hosts_data %}
        <div class="col-12 col-lg-6">
          <div class="card h-100 border-start border-5 border-{{ host.status_color }}">
            <div class="card-body">
              <div class="row row-cols-2 row-cols-sm-3 row-cols-lg-4 g-2 mb-2">
                <div class="col">
                  <strong style="font-size: 20px; font-weight: bold;">{{ host.host_name }}</strong></br>
                  <strong class="d-block text-muted small">SLA Calculado</strong>
                  <span>{{ host.sli_display }}</span>
                </div>
                <div class="col">
                  <strong class="d-block text-muted small">Meta SLA</strong>
                  <span>{{ host.sla_target }}%</span>
                </div>
                <div class="col">
                  <strong class="d-block text-muted small">Indisponibilidade</strong>
                  <span>{{ host.total_downtime }}</span>
                </div>
                <div class="col">
                  <strong class="d-block text-muted small">Incidentes</strong>
                  <span>{{ host.incident_count }}</span>
                </div>
                <div class="col">
                  <strong class="d-block text-muted small">Maior Parada</strong>
                  <span>{{ host.longest_downtime }}</span>
                </div>
              </div>
              {% if host.incidents %}
                <div class="mt-1">
                  <strong class="d-block text-muted small" margin="0">Incidentes no período</strong>
                  <div class="table-responsive" margin="0">
                    <table class="table table-sm table-striped align-middle mb-0">
                      <thead class="table-light">
                        <tr>
                          <th scope="col">Início</th>
                          <th scope="col">Fim</th>
                          <th scope="col" class="text-center">Duração</th>
                          <th scope="col">Severidade</th>
                          <th scope="col">Problema</th>
                        </tr>
                      </thead>
                      <tbody>
                        {% for incident in host.incidents %}
                          <tr>
                            <td>{{ incident.start_str }}</td>
                            <td>{{ incident.end_str }}</td>
                            <td class="text-center">{{ incident.duration }}</td>
                            <td>{{ incident.severity }}</td>
                            <td>{{ incident.name }}</td>
                          </tr>
                        {% endfor %}
                      </tbody>
                    </table>
                  </div>
                </div>
              {% else %}
                <div class="text-muted small fst-italic" margin="4">Nenhum incidente registrado no período.</div>
                <br>
              {% endif %}
            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>
