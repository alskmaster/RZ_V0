#!/usr/bin/env sh

# Valida o cabeçalho do commit segundo o padrão:
# [Ação] [Serviço] [Sessão] - Descrição concisa

MSG_FILE="$1"
if [ ! -f "$MSG_FILE" ]; then
  exit 0
fi

# Lê a primeira linha não vazia não comentada
HEADER=$(sed -e 's/\r$//' "$MSG_FILE" | grep -v '^#' | grep -m1 -E '.+')

# Regex: [texto] [texto] [texto] - descr
echo "$HEADER" | grep -E '^\[[^\]]+\] \[[^\]]+\] \[[^\]]+\] - .+' >/dev/null 2>&1
OK=$?

if [ $OK -ne 0 ]; then
  echo >&2 "\nCommit inválido. Use o formato:"
  echo >&2 "[Ação] [Serviço] [Sessão] - Descrição concisa da atualização\n"
  echo >&2 "Ex.: [Ajuste] [WebApp] [UI] - Corrige labels com acentuação no builder"
  exit 1
fi

exit 0

