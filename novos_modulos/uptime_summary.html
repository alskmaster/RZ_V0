<style>
  .timeline-bar {
    position: relative;
    width: 100%;
    height: 15px;
    background-color: #dcedc8; /* Verde claro de fundo */
    border-radius: 4px;
    overflow: hidden;
    border: 1px solid #c5e1a5;
  }
  .downtime-segment {
    position: absolute;
    height: 100%;
    background-color: #e57373; /* Vermelho para indisponibilidade */
    top: 0;
  }
</style>

<div class="report-module-instance" {% if new_page %}style="page-break-before: always;"{% endif %}>
  <h2>{{ title or 'Resumo de Disponibilidade (Uptime)' }}</h2>

  {% if data.error %}
    <div class="alert alert-warning" role="alert">{{ data.error }}</div>
  {% elif not data.hosts_data %}
    <div class="alert alert-info" role="alert">
      Nenhum dado de disponibilidade encontrado para os filtros selecionados.
    </div>
  {% else %}
    <p class="text-muted small">
      Período de análise: de <strong>{{ data.period_start_str }}</strong> até <strong>{{ data.period_end_str }}</strong>.
    </p>

    <div class="row g-4">
      {% for host in data.hosts_data %}
        <div class="col-12 col-lg-6">
          <div class="card h-100 border-start border-5 border-{{ host.status_color }}">
            <div class="card-header d-flex justify-content-between align-items-center">
              <h5 class="mb-0 text-primary">{{ host.host_name }}</h5>
              <span class="badge bg-{{ host.status_color }} fs-6">{{ host.sli }}%</span>
            </div>
            <div class="card-body">
              <div class="row">
                <div class="col-6 col-sm-3 mb-3">
                  <strong class="d-block text-muted small">Meta SLA</strong>
                  <span>{{ host.sla_target }}%</span>
                </div>
                <div class="col-6 col-sm-3 mb-3">
                  <strong class="d-block text-muted small">Indisponibilidade</strong>
                  <span>{{ host.total_downtime }}</span>
                </div>
                <div class="col-6 col-sm-3 mb-3">
                  <strong class="d-block text-muted small">Incidentes</span>
                  <span>{{ host.incident_count }}</span>
                </div>
                <div class="col-6 col-sm-3 mb-3">
                  <strong class="d-block text-muted small">Maior Parada</strong>
                  <span>{{ host.longest_downtime }}</span>
                </div>
              </div>

              <strong class="d-block text-muted small mb-1">Linha do Tempo de Indisponibilidade</strong>
              <div class="timeline-bar" title="Linha do tempo representando o período do relatório. Segmentos vermelhos indicam indisponibilidade.">
                {% for event in host.timeline_events %}
                  <div
                    class="downtime-segment"
                    style="left: {{ event.left_percent }}%; width: {{ event.width_percent }}%;"
                    data-bs-toggle="tooltip"
                    data-bs-placement="top"
                    title="{{ event.tooltip }}">
                  </div>
                {% endfor %}
              </div>

            </div>
          </div>
        </div>
      {% endfor %}
    </div>
  {% endif %}
</div>